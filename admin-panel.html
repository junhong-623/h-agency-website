<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â„‹ Agency ç®¡ç†åå°</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --bg-primary: #fff9fb;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #1a0d1a;
            --text-secondary: #4a2847;
            --accent-pink: #ff6b9d;
            --accent-rose: #ff8fb5;
            --accent-deep: #d91e63;
            --gradient-1: linear-gradient(135deg, #ff6b9d 0%, #ff8fb5 100%);
            --shadow-soft: 0 8px 32px rgba(255, 107, 157, 0.2);
            --shadow-hover: 0 12px 48px rgba(255, 107, 157, 0.3);
        }

        [data-theme="dark"] {
            --bg-primary: #1a0d1a;
            --bg-secondary: #2d1b2e;
            --bg-card: #3d2a3d;
            --text-primary: #ffd4e3;
            --text-secondary: #ffb6c9;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.4s ease;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .login-box {
            background: var(--bg-card);
            padding: 3rem;
            border-radius: 30px;
            box-shadow: var(--shadow-hover);
            max-width: 450px;
            width: 100%;
        }

        .login-logo {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .login-title {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.2rem;
        }

        .form-group { margin-bottom: 1.5rem; }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid var(--accent-rose);
            border-radius: 15px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 1rem;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-pink);
            box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
        }

        .btn {
            width: 100%;
            padding: 1.2rem;
            background: var(--gradient-1);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--accent-pink);
            color: var(--accent-pink);
        }

        .btn-secondary:hover {
            background: var(--accent-pink);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #e57373 100%);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            width: auto;
            display: inline-block;
            margin: 0.2rem;
            font-size: 0.9rem;
        }

        .error-message {
            background: #ffe5ec;
            color: #d91e63;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show { display: block; }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message.show { display: block; }

        .hidden { display: none !important; }

        .header {
            background: var(--bg-secondary);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-soft);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--accent-rose);
            padding-bottom: 0.5rem;
        }

        .tab {
            padding: 0.7rem 2rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            font-family: 'Noto Sans SC', sans-serif;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--gradient-1);
            color: white;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .card {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--gradient-1);
            color: white;
            padding: 1rem;
            text-align: left;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--accent-rose);
        }

        .status-badge {
            padding: 0.4rem 1rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-approved {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-rejected {
            background: #ffebee;
            color: #c62828;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent-rose);
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--accent-pink);
        }

        .info-row {
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 10px;
        }

        .info-label {
            font-weight: 600;
            color: var(--accent-pink);
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .info-value {
            color: var(--text-primary);
        }

        .action-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--accent-rose);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff6b9d;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }

        .password-strength {
            margin-top: 0.5rem;
            height: 4px;
            border-radius: 2px;
            background: #e0e0e0;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            transition: all 0.3s ease;
        }

        .strength-weak { background: #f44336; width: 33%; }
        .strength-medium { background: #ff9800; width: 66%; }
        .strength-strong { background: #4caf50; width: 100%; }

        .password-hint {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        @media (max-width: 768px) {
            .tabs {
                justify-content: flex-start;
                overflow-x: auto;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">â„‹ Agency</div>
            <div class="login-title">ç®¡ç†åå°ç™»å½•</div>
            <div class="warning-box">
                <strong>ğŸ”‘ é»˜è®¤è´¦å·ï¼š</strong><br>
                ç”¨æˆ·å: <code>admin</code><br>
                å¯†ç : <code>admin123</code><br>
                <small>é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç ï¼</small>
            </div>
            <div id="loginError" class="error-message"></div>
            <div>
                <div class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <button class="btn" onclick="login()">ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
        <div class="header">
            <div class="logo">â„‹ Agency ç®¡ç†åå°</div>
            <div style="display: flex; gap: 1rem; align-items: center;">
                <span id="currentUser"></span>
                <button class="btn btn-small btn-secondary" onclick="logout()">ç™»å‡º</button>
            </div>
        </div>

        <div class="container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('submissions')">ç”³è¯·å®¡æ ¸</button>
                <button class="tab" onclick="switchTab('leaderboard')">æ’è¡Œæ¦œç®¡ç†</button>
                <button class="tab" onclick="switchTab('password')">ä¿®æ”¹å¯†ç </button>
                <button class="tab" onclick="switchTab('admins')">ç®¡ç†å‘˜è®¾ç½®</button>
            </div>

            <!-- Submissions Tab -->
            <div id="submissions" class="tab-content active">
                <div class="card">
                    <h3>ç”³è¯·å®¡æ ¸åˆ—è¡¨</h3>
                    <div id="submissionsTable">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div id="leaderboard" class="tab-content">
                <div class="card">
                    <h3>æ·»åŠ /ç¼–è¾‘ä¸»æ’­</h3>
                    <input type="hidden" id="editId">
                    <div class="form-group">
                        <label>ä¸»æ’­æ˜µç§°ï¼ˆä¸­æ–‡ï¼‰*</label>
                        <input type="text" id="streamerNameZh">
                    </div>
                    <div class="form-group">
                        <label>ä¸»æ’­æ˜µç§°ï¼ˆè‹±æ–‡ï¼‰*</label>
                        <input type="text" id="streamerNameEn">
                    </div>
                    <div class="form-group">
                        <label>ç›´æ’­é“¾æ¥</label>
                        <input type="text" id="streamUrl" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>æœ¬æœˆæ”¶å…¥ (Â¥)*</label>
                        <input type="number" id="income">
                    </div>
                    <div class="form-group">
                        <label>ç›´æ’­æ—¶é•¿ï¼ˆå°æ—¶ï¼‰*</label>
                        <input type="number" id="hours">
                    </div>
                    <div class="form-group">
                        <label>ç²‰ä¸å¢é•¿*</label>
                        <input type="number" id="fansGrowth">
                    </div>
                    <div class="form-group">
                        <label>å¾½ç« ï¼ˆä¸­æ–‡ï¼‰*</label>
                        <input type="text" id="badgeZh" placeholder="ä¾‹å¦‚ï¼šæœˆåº¦å† å†›">
                    </div>
                    <div class="form-group">
                        <label>å¾½ç« ï¼ˆè‹±æ–‡ï¼‰*</label>
                        <input type="text" id="badgeEn" placeholder="ä¾‹å¦‚ï¼šMonthly Champion">
                    </div>
                    <button class="btn" onclick="saveStreamer()">ä¿å­˜ä¸»æ’­</button>
                </div>

                <div class="card">
                    <h3>å½“å‰æ’è¡Œæ¦œ</h3>
                    <div id="leaderboardList">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <!-- Change Password Tab -->
            <div id="password" class="tab-content">
                <div class="card">
                    <h3>ä¿®æ”¹å¯†ç </h3>
                    <div class="info-box">
                        <strong>â„¹ï¸ å®‰å…¨æç¤ºï¼š</strong><br>
                        â€¢ å¯†ç é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦<br>
                        â€¢ å»ºè®®ä½¿ç”¨å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦çš„ç»„åˆ<br>
                        â€¢ ä¿®æ”¹å¯†ç åéœ€è¦é‡æ–°ç™»å½•
                    </div>
                    <div id="passwordError" class="error-message"></div>
                    <div id="passwordSuccess" class="success-message"></div>
                    
                    <div class="form-group">
                        <label>å½“å‰å¯†ç  *</label>
                        <input type="password" id="currentPassword" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
                    </div>
                    
                    <div class="form-group">
                        <label>æ–°å¯†ç  *</label>
                        <input type="password" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰" oninput="checkPasswordStrength()">
                        <div class="password-strength">
                            <div id="strengthBar" class="password-strength-bar"></div>
                        </div>
                        <div id="strengthText" class="password-hint"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¡®è®¤æ–°å¯†ç  *</label>
                        <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                    </div>
                    
                    <button class="btn" onclick="changePassword()">ç¡®è®¤ä¿®æ”¹</button>
                    <button class="btn btn-secondary" onclick="resetPasswordForm()" style="margin-top: 1rem;">å–æ¶ˆ</button>
                </div>
            </div>

            <!-- Admins Tab -->
            <div id="admins" class="tab-content">
                <div class="card">
                    <h3>æ·»åŠ æ–°ç®¡ç†å‘˜</h3>
                    <div class="form-group">
                        <label>ç”¨æˆ·å*</label>
                        <input type="text" id="newAdminUsername" placeholder="è‡³å°‘4ä¸ªå­—ç¬¦">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç *</label>
                        <input type="password" id="newAdminPassword" placeholder="è‡³å°‘6ä¸ªå­—ç¬¦">
                    </div>
                    <div class="form-group">
                        <label>å§“å</label>
                        <input type="text" id="newAdminName">
                    </div>
                    <button class="btn" onclick="addAdmin()">æ·»åŠ ç®¡ç†å‘˜</button>
                </div>

                <div class="card">
                    <h3>ç®¡ç†å‘˜åˆ—è¡¨</h3>
                    <div id="adminsTable">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">å®¡æ ¸ç”³è¯·</h2>
                <button class="close-btn" onclick="closeReviewModal()">&times;</button>
            </div>
            
            <div id="reviewContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
          apiKey: "AIzaSyBSqkaYW6UbxyaLHPLZvfhaIIJFOvPeYN0",
          authDomain: "h-agency-recruitment.firebaseapp.com",
          databaseURL: "https://h-agency-recruitment-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "h-agency-recruitment",
          storageBucket: "h-agency-recruitment.firebasestorage.app",
          messagingSenderId: "198153569809",
          appId: "1:198153569809:web:3e018109dba4db014793b0",
          measurementId: "G-M6E1KP1FYL"
        };

        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('Firebase initialized');
        } catch (error) {
            console.error('Firebase error:', error);
            alert('Firebaseæœªé…ç½®ï¼è¯·å…ˆé…ç½®Firebase');
        }

        let currentAdminKey = null;
        let currentReviewId = null;

        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                hash = ((hash << 5) - hash) + password.charCodeAt(i);
                hash = hash & hash;
            }
            return hash.toString();
        }

        async function initDefaultAdmin() {
            if (!database) return;
            const snapshot = await database.ref('admins').once('value');
            if (!snapshot.val()) {
                await database.ref('admins').push({
                    username: 'admin',
                    password: hashPassword('admin123'),
                    name: 'è¶…çº§ç®¡ç†å‘˜',
                    isDefault: true
                });
            }
        }

        function checkAuth() {
            const user = localStorage.getItem('currentUser');
            currentAdminKey = localStorage.getItem('currentAdminKey');
            if (!user || !currentAdminKey) {
                document.getElementById('loginPage').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
                return false;
            }
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('currentUser').textContent = 'ğŸ‘¤ ' + user;
            return true;
        }

        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (!username || !password) {
                errorDiv.textContent = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
                errorDiv.classList.add('show');
                return;
            }

            const snapshot = await database.ref('admins').once('value');
            const admins = snapshot.val();
            if (!admins) {
                errorDiv.textContent = 'ç®¡ç†å‘˜æ•°æ®ä¸å­˜åœ¨';
                errorDiv.classList.add('show');
                return;
            }

            const hashedPwd = hashPassword(password);
            let found = null, foundKey = null;

            for (const [key, admin] of Object.entries(admins)) {
                if (admin.username === username && admin.password === hashedPwd) {
                    found = admin;
                    foundKey = key;
                    break;
                }
            }

            if (found) {
                localStorage.setItem('currentUser', found.name || found.username);
                localStorage.setItem('currentAdminKey', foundKey);
                errorDiv.classList.remove('show');
                checkAuth();
                loadSubmissions();
            } else {
                errorDiv.textContent = 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯';
                errorDiv.classList.add('show');
            }
        }

        function logout() {
            if (confirm('ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                localStorage.clear();
                checkAuth();
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            if (tabName === 'submissions') loadSubmissions();
            else if (tabName === 'leaderboard') loadLeaderboard();
            else if (tabName === 'admins') loadAdmins();
        }

        async function loadSubmissions() {
            if (!database) return;
            const snapshot = await database.ref('submissions').once('value');
            const data = snapshot.val();
            const tableDiv = document.getElementById('submissionsTable');
            if (!data) {
                tableDiv.innerHTML = '<p>æš‚æ— ç”³è¯·</p>';
                return;
            }
            const arr = Object.entries(data).map(([k, v]) => ({...v, key: k}));
            arr.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt));
            
            let html = '<table><thead><tr><th>å§“å</th><th>ç”µè¯</th><th>ç»éªŒ</th><th>æäº¤æ—¶é—´</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead><tbody>';
            arr.forEach(sub => {
                const time = sub.submittedAt ? new Date(sub.submittedAt).toLocaleString('zh-CN') : '-';
                const status = sub.status || 'pending';
                let statusBadge = '';
                if (status === 'pending' || status === 'new') {
                    statusBadge = '<span class="status-badge status-pending">å¾…å®¡æ ¸</span>';
                } else if (status === 'approved') {
                    statusBadge = '<span class="status-badge status-approved">å·²é€šè¿‡</span>';
                } else if (status === 'rejected') {
                    statusBadge = '<span class="status-badge status-rejected">å·²æ‹’ç»</span>';
                }
                
                html += `<tr>
                    <td>${sub.name || '-'}</td>
                    <td>${sub.phone || '-'}</td>
                    <td>${sub.experience || '-'}</td>
                    <td>${time}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-small btn-success" onclick="reviewApplication('${sub.key}')">å®¡æ ¸</button>
                        <button class="btn btn-small btn-danger" onclick="deleteSubmission('${sub.key}')">åˆ é™¤</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';
            tableDiv.innerHTML = html;
        }

        async function reviewApplication(key) {
            currentReviewId = key;
            const snapshot = await database.ref('submissions/' + key).once('value');
            const sub = snapshot.val();
            
            if (!sub) return;
            
            const content = document.getElementById('reviewContent');
            const status = sub.status || 'pending';
            
            content.innerHTML = `
                <div class="info-row">
                    <div class="info-label">ç”³è¯·äººå§“å</div>
                    <div class="info-value">${sub.name || '-'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">å¹´é¾„</div>
                    <div class="info-value">${sub.age || '-'} å²</div>
                </div>
                <div class="info-row">
                    <div class="info-label">è”ç³»ç”µè¯</div>
                    <div class="info-value">${sub.phone || '-'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">å¾®ä¿¡å·</div>
                    <div class="info-value">${sub.wechat || 'æœªå¡«å†™'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">é‚®ç®±</div>
                    <div class="info-value">${sub.email || 'æœªå¡«å†™'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ç›´æ’­ç»éªŒ</div>
                    <div class="info-value">${sub.experience || '-'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">æ“…é•¿é¢†åŸŸ</div>
                    <div class="info-value">${sub.specialization || '-'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ä¸ªäººç®€ä»‹</div>
                    <div class="info-value" style="white-space: pre-wrap;">${sub.introduction || '-'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ç¤¾äº¤åª’ä½“</div>
                    <div class="info-value">${sub.social || 'æœªå¡«å†™'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">æäº¤æ—¶é—´</div>
                    <div class="info-value">${sub.submittedAt ? new Date(sub.submittedAt).toLocaleString('zh-CN') : '-'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">å½“å‰çŠ¶æ€</div>
                    <div class="info-value">
                        ${status === 'approved' ? 'âœ… å·²é€šè¿‡' : status === 'rejected' ? 'âŒ å·²æ‹’ç»' : 'â³ å¾…å®¡æ ¸'}
                    </div>
                </div>
                
                ${status === 'approved' && sub.nickname ? `
                <div class="info-row">
                    <div class="info-label">ä¸»æ’­æ˜µç§°</div>
                    <div class="info-value">${sub.nickname}</div>
                </div>
                ` : ''}
                
                ${status === 'rejected' && sub.rejectionReason ? `
                <div class="info-row">
                    <div class="info-label">æ‹’ç»ç†ç”±</div>
                    <div class="info-value">${sub.rejectionReason}</div>
                </div>
                ` : ''}
                
                <div class="action-section">
                    <h3 style="margin-bottom: 1rem;">å®¡æ ¸æ“ä½œ</h3>
                    
                    <!-- Approve Section -->
                    <div id="approveSection" style="margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-primary); border-radius: 15px;">
                        <h4 style="color: #4caf50; margin-bottom: 1rem;">âœ… é€šè¿‡ç”³è¯·</h4>
                        <div class="form-group">
                            <label>ä¸»æ’­æ˜µç§°ï¼ˆä¸­æ–‡ï¼‰*</label>
                            <input type="text" id="nicknameZh" class="form-input" placeholder="ä¾‹å¦‚ï¼šç”œå¿ƒå°å…”" value="${sub.nickname || ''}">
                        </div>
                        <div class="form-group">
                            <label>ä¸»æ’­æ˜µç§°ï¼ˆè‹±æ–‡ï¼‰*</label>
                            <input type="text" id="nicknameEn" class="form-input" placeholder="ä¾‹å¦‚ï¼šSweet Bunny" value="${sub.nicknameEn || ''}">
                        </div>
                        <div class="form-group">
                            <label>ç›´æ’­é“¾æ¥</label>
                            <input type="text" id="reviewStreamUrl" class="form-input" placeholder="https://..." value="${sub.streamUrl || ''}">
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="addToLeaderboard" ${sub.inLeaderboard ? 'checked' : ''}>
                            <label style="margin: 0;">åŒæ—¶æ·»åŠ åˆ°æ’è¡Œæ¦œ</label>
                        </div>
                        <button class="btn btn-success" onclick="approveApplication()" style="margin-top: 1rem;">ç¡®è®¤é€šè¿‡</button>
                    </div>
                    
                    <!-- Reject Section -->
                    <div id="rejectSection" style="padding: 1.5rem; background: var(--bg-primary); border-radius: 15px;">
                        <h4 style="color: #f44336; margin-bottom: 1rem;">âŒ æ‹’ç»ç”³è¯·</h4>
                        <div class="form-group">
                            <label>æ‹’ç»ç†ç”± *</label>
                            <textarea id="rejectionReason" class="form-input" placeholder="è¯·å¡«å†™æ‹’ç»ç†ç”±...">${sub.rejectionReason || ''}</textarea>
                        </div>
                        <button class="btn btn-danger" onclick="rejectApplication()">ç¡®è®¤æ‹’ç»</button>
                    </div>
                </div>
            `;
            
            document.getElementById('reviewModal').classList.add('show');
        }

        async function approveApplication() {
            const nicknameZh = document.getElementById('nicknameZh').value.trim();
            const nicknameEn = document.getElementById('nicknameEn').value.trim();
            const streamUrl = document.getElementById('reviewStreamUrl').value.trim();
            const addToLeaderboard = document.getElementById('addToLeaderboard').checked;
            
            if (!nicknameZh || !nicknameEn) {
                alert('è¯·å¡«å†™ä¸»æ’­æ˜µç§°ï¼ˆä¸­è‹±æ–‡ï¼‰');
                return;
            }
            
            const updates = {
                status: 'approved',
                nickname: nicknameZh,
                nicknameEn: nicknameEn,
                streamUrl: streamUrl,
                inLeaderboard: addToLeaderboard,
                approvedAt: new Date().toISOString(),
                approvedBy: localStorage.getItem('currentUser')
            };
            
            try {
                await database.ref('submissions/' + currentReviewId).update(updates);
                
                // If adding to leaderboard
                if (addToLeaderboard) {
                    const submissionSnapshot = await database.ref('submissions/' + currentReviewId).once('value');
                    const submission = submissionSnapshot.val();
                    
                    const leaderboardData = {
                        nameZh: nicknameZh,
                        nameEn: nicknameEn,
                        streamUrl: streamUrl,
                        income: 0,
                        hours: 0,
                        fansGrowth: 0,
                        badgeZh: 'æ–°äººä¸»æ’­',
                        badgeEn: 'Newcomer',
                        originalName: submission.name,
                        phone: submission.phone,
                        addedAt: new Date().toISOString(),
                        submissionId: currentReviewId
                    };
                    
                    await database.ref('leaderboard').push(leaderboardData);
                }
                
                alert('å®¡æ ¸é€šè¿‡ï¼');
                closeReviewModal();
                loadSubmissions();
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        async function rejectApplication() {
            const reason = document.getElementById('rejectionReason').value.trim();
            
            if (!reason) {
                alert('è¯·å¡«å†™æ‹’ç»ç†ç”±');
                return;
            }
            
            const updates = {
                status: 'rejected',
                rejectionReason: reason,
                rejectedAt: new Date().toISOString(),
                rejectedBy: localStorage.getItem('currentUser')
            };
            
            try {
                await database.ref('submissions/' + currentReviewId).update(updates);
                alert('å·²æ‹’ç»ç”³è¯·');
                closeReviewModal();
                loadSubmissions();
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.remove('show');
            currentReviewId = null;
        }

        async function deleteSubmission(key) {
            if (!confirm('ç¡®å®šåˆ é™¤è¿™æ¡ç”³è¯·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
            await database.ref('submissions/' + key).remove();
            loadSubmissions();
        }

        async function loadLeaderboard() {
            if (!database) return;
            const snapshot = await database.ref('leaderboard').once('value');
            const data = snapshot.val();
            const listDiv = document.getElementById('leaderboardList');
            if (!data) {
                listDiv.innerHTML = '<p>æš‚æ— æ’è¡Œæ¦œ</p>';
                return;
            }
            const arr = Object.entries(data).map(([k, v]) => ({...v, key: k}));
            arr.sort((a, b) => (b.income || 0) - (a.income || 0));
            
            let html = '';
            arr.forEach((s, i) => {
                html += `<div style="padding:1rem;background:var(--bg-secondary);margin-bottom:1rem;border-radius:10px;">
                    <strong>${i+1}. ${s.nameZh||'-'} / ${s.nameEn||'-'}</strong> - Â¥${(s.income||0).toLocaleString()}
                    ${s.streamUrl ? `<br><small>ç›´æ’­é“¾æ¥: <a href="${s.streamUrl}" target="_blank">${s.streamUrl}</a></small>` : ''}
                    <div style="margin-top:0.5rem;">
                        <button class="btn btn-small" onclick="editStreamer('${s.key}')">ç¼–è¾‘</button>
                        <button class="btn btn-small btn-secondary" onclick="deleteStreamer('${s.key}')">åˆ é™¤</button>
                    </div>
                </div>`;
            });
            listDiv.innerHTML = html;
        }

        async function saveStreamer() {
            const editId = document.getElementById('editId').value;
            const streamer = {
                nameZh: document.getElementById('streamerNameZh').value.trim(),
                nameEn: document.getElementById('streamerNameEn').value.trim(),
                streamUrl: document.getElementById('streamUrl').value.trim(),
                income: parseInt(document.getElementById('income').value) || 0,
                hours: parseInt(document.getElementById('hours').value) || 0,
                fansGrowth: parseInt(document.getElementById('fansGrowth').value) || 0,
                badgeZh: document.getElementById('badgeZh').value.trim(),
                badgeEn: document.getElementById('badgeEn').value.trim()
            };
            if (!streamer.nameZh || !streamer.nameEn) {
                alert('è¯·å¡«å†™å¿…å¡«é¡¹ï¼');
                return;
            }
            if (editId) {
                await database.ref('leaderboard/' + editId).update(streamer);
            } else {
                await database.ref('leaderboard').push(streamer);
            }
            document.getElementById('editId').value = '';
            ['streamerNameZh', 'streamerNameEn', 'streamUrl', 'income', 'hours', 'fansGrowth', 'badgeZh', 'badgeEn'].forEach(id => {
                document.getElementById(id).value = '';
            });
            loadLeaderboard();
            alert('ä¿å­˜æˆåŠŸï¼');
        }

        async function editStreamer(key) {
            const snapshot = await database.ref('leaderboard/' + key).once('value');
            const s = snapshot.val();
            document.getElementById('editId').value = key;
            document.getElementById('streamerNameZh').value = s.nameZh || '';
            document.getElementById('streamerNameEn').value = s.nameEn || '';
            document.getElementById('streamUrl').value = s.streamUrl || '';
            document.getElementById('income').value = s.income || '';
            document.getElementById('hours').value = s.hours || '';
            document.getElementById('fansGrowth').value = s.fansGrowth || '';
            document.getElementById('badgeZh').value = s.badgeZh || '';
            document.getElementById('badgeEn').value = s.badgeEn || '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function deleteStreamer(key) {
            if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
            await database.ref('leaderboard/' + key).remove();
            loadLeaderboard();
        }

        function checkPasswordStrength() {
            const pwd = document.getElementById('newPassword').value;
            const bar = document.getElementById('strengthBar');
            const text = document.getElementById('strengthText');
            if (!pwd) {
                bar.className = 'password-strength-bar';
                text.textContent = '';
                return;
            }
            let strength = 0;
            if (pwd.length >= 6) strength++;
            if (pwd.length >= 10) strength++;
            if (/[a-z]/.test(pwd) && /[A-Z]/.test(pwd)) strength++;
            if (/\d/.test(pwd)) strength++;
            if (/[^a-zA-Z0-9]/.test(pwd)) strength++;
            if (strength <= 2) {
                bar.className = 'password-strength-bar strength-weak';
                text.textContent = 'å¯†ç å¼ºåº¦ï¼šå¼±';
                text.style.color = '#f44336';
            } else if (strength <= 3) {
                bar.className = 'password-strength-bar strength-medium';
                text.textContent = 'å¯†ç å¼ºåº¦ï¼šä¸­ç­‰';
                text.style.color = '#ff9800';
            } else {
                bar.className = 'password-strength-bar strength-strong';
                text.textContent = 'å¯†ç å¼ºåº¦ï¼šå¼º';
                text.style.color = '#4caf50';
            }
        }

        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPwd = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('passwordError');
            const successDiv = document.getElementById('passwordSuccess');
            errorDiv.classList.remove('show');
            successDiv.classList.remove('show');
            if (!current || !newPwd || !confirm) {
                errorDiv.textContent = 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ';
                errorDiv.classList.add('show');
                return;
            }
            if (newPwd.length < 6) {
                errorDiv.textContent = 'æ–°å¯†ç é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦';
                errorDiv.classList.add('show');
                return;
            }
            if (newPwd !== confirm) {
                errorDiv.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´';
                errorDiv.classList.add('show');
                return;
            }
            if (!currentAdminKey) {
                errorDiv.textContent = 'æœªæ‰¾åˆ°å½“å‰ç”¨æˆ·ï¼Œè¯·é‡æ–°ç™»å½•';
                errorDiv.classList.add('show');
                return;
            }
            const snapshot = await database.ref('admins/' + currentAdminKey).once('value');
            const admin = snapshot.val();
            if (!admin || admin.password !== hashPassword(current)) {
                errorDiv.textContent = 'å½“å‰å¯†ç é”™è¯¯';
                errorDiv.classList.add('show');
                return;
            }
            try {
                await database.ref('admins/' + currentAdminKey).update({
                    password: hashPassword(newPwd)
                });
                successDiv.textContent = 'å¯†ç ä¿®æ”¹æˆåŠŸï¼2ç§’åå°†è‡ªåŠ¨ç™»å‡ºï¼Œè¯·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•';
                successDiv.classList.add('show');
                setTimeout(() => { logout(); }, 2000);
            } catch (error) {
                errorDiv.textContent = 'ä¿®æ”¹å¯†ç å¤±è´¥ï¼š' + error.message;
                errorDiv.classList.add('show');
            }
        }

        function resetPasswordForm() {
            ['currentPassword', 'newPassword', 'confirmPassword'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('passwordError').classList.remove('show');
            document.getElementById('passwordSuccess').classList.remove('show');
            document.getElementById('strengthBar').className = 'password-strength-bar';
            document.getElementById('strengthText').textContent = '';
        }

        async function loadAdmins() {
            if (!database) return;
            const snapshot = await database.ref('admins').once('value');
            const data = snapshot.val();
            const tableDiv = document.getElementById('adminsTable');
            if (!data) {
                tableDiv.innerHTML = '<p>æš‚æ— ç®¡ç†å‘˜</p>';
                return;
            }
            const arr = Object.entries(data).map(([k, v]) => ({...v, key: k}));
            let html = '<table><thead><tr><th>ç”¨æˆ·å</th><th>å§“å</th><th>æ“ä½œ</th></tr></thead><tbody>';
            arr.forEach(admin => {
                html += `<tr><td>${admin.username||'-'}</td><td>${admin.name||'-'}</td><td>${!admin.isDefault ? `<button class="btn btn-small btn-secondary" onclick="deleteAdmin('${admin.key}')">åˆ é™¤</button>` : '-'}</td></tr>`;
            });
            html += '</tbody></table>';
            tableDiv.innerHTML = html;
        }

        async function addAdmin() {
            const username = document.getElementById('newAdminUsername').value.trim();
            const password = document.getElementById('newAdminPassword').value;
            const name = document.getElementById('newAdminName').value.trim();
            if (!username || !password) {
                alert('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ï¼');
                return;
            }
            if (username.length < 4 || password.length < 6) {
                alert('ç”¨æˆ·åè‡³å°‘4ä¸ªå­—ç¬¦ï¼Œå¯†ç è‡³å°‘6ä¸ªå­—ç¬¦ï¼');
                return;
            }
            const snapshot = await database.ref('admins').once('value');
            const admins = snapshot.val();
            if (admins) {
                for (const admin of Object.values(admins)) {
                    if (admin.username === username) {
                        alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼');
                        return;
                    }
                }
            }
            await database.ref('admins').push({
                username,
                password: hashPassword(password),
                name,
                createdAt: new Date().toISOString(),
                isDefault: false
            });
            document.getElementById('newAdminUsername').value = '';
            document.getElementById('newAdminPassword').value = '';
            document.getElementById('newAdminName').value = '';
            loadAdmins();
            alert('æ·»åŠ æˆåŠŸï¼');
        }

        async function deleteAdmin(key) {
            if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
            await database.ref('admins/' + key).remove();
            loadAdmins();
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await initDefaultAdmin();
            checkAuth();
            ['loginUsername', 'loginPassword'].forEach(id => {
                document.getElementById(id)?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') login();
                });
            });
        });
    </script>
</body>
</html>
